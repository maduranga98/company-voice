rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // ============================================
    // IMPORTANT: FIREBASE AUTH IS DISABLED
    // ============================================
    // These rules allow unauthenticated access for testing purposes.
    // WARNING: This is NOT suitable for production use.
    // You should implement proper authentication and authorization
    // before deploying to production.
    // ============================================

    // ============================================
    // USERS COLLECTION
    // ============================================
    match /users/{userId} {
      allow read, write: if true;
    }

    // ============================================
    // COMPANIES COLLECTION
    // ============================================
    match /companies/{companyId} {
      allow read, write: if true;
    }

    // ============================================
    // POSTS COLLECTION
    // ============================================
    match /posts/{postId} {
      // Write access: allow all for testing
      allow write: if true;

      // Read access: enforce privacy levels
      allow read: if true
        // Allow if no privacy level is set (default to public)
        || !('privacyLevel' in resource.data)
        // Allow public posts
        || resource.data.privacyLevel == 'company_public'
        // Allow HR-only posts for HR, company_admin, and super_admin
        || (resource.data.privacyLevel == 'hr_only'
            && true) // Simplified for testing - implement proper auth check
        // Allow department-only posts for users in same department or HR
        || (resource.data.privacyLevel == 'department_only'
            && true); // Simplified for testing - implement proper auth check

      // Likes subcollection
      match /likes/{likeId} {
        allow read, write: if true;
      }
    }

    // ============================================
    // COMMENTS COLLECTION
    // ============================================
    match /comments/{commentId} {
      allow read, write: if true;
    }

    // ============================================
    // DISCUSSIONS COLLECTION
    // ============================================
    match /discussions/{discussionId} {
      allow read, write: if true;
    }

    // ============================================
    // NOTIFICATIONS COLLECTION
    // ============================================
    match /notifications/{notificationId} {
      allow read, write: if true;
    }

    // ============================================
    // POST ACTIVITIES COLLECTION (Timeline)
    // ============================================
    match /postActivities/{activityId} {
      allow read, write: if true;
    }

    // ============================================
    // POST VIEWS COLLECTION (For "My Posts" unread tracking)
    // ============================================
    match /postViews/{viewId} {
      allow read, write: if true;
    }

    // ============================================
    // DEPARTMENTS COLLECTION
    // ============================================
    match /departments/{departmentId} {
      allow read, write: if true;
    }

    // ============================================
    // BILLING: SUBSCRIPTIONS COLLECTION
    // ============================================
    match /subscriptions/{subscriptionId} {
      allow read, write: if true;
    }

    // ============================================
    // BILLING: INVOICES COLLECTION
    // ============================================
    match /invoices/{invoiceId} {
      allow read, write: if true;
    }

    // ============================================
    // BILLING: USAGE RECORDS COLLECTION
    // ============================================
    match /usageRecords/{recordId} {
      allow read, write: if true;
    }

    // ============================================
    // BILLING: PAYMENTS COLLECTION
    // ============================================
    match /payments/{paymentId} {
      allow read, write: if true;
    }

    // ============================================
    // BILLING: PAYMENT METHODS COLLECTION
    // ============================================
    match /paymentMethods/{methodId} {
      allow read, write: if true;
    }

    // ============================================
    // BILLING: BILLING HISTORY COLLECTION
    // ============================================
    match /billingHistory/{historyId} {
      allow read, write: if true;
    }

    // ============================================
    // BILLING: PRICING TIERS COLLECTION
    // ============================================
    match /pricingTiers/{tierId} {
      allow read, write: if true;
    }

    // ============================================
    // BILLING: BILLING DISPUTES COLLECTION
    // ============================================
    match /billingDisputes/{disputeId} {
      allow read, write: if true;
    }

    // ============================================
    // BILLING: REVENUE REPORTS COLLECTION
    // ============================================
    match /revenueReports/{reportId} {
      allow read, write: if true;
    }

    // ============================================
    // SYSTEM AUDIT LOGS COLLECTION
    // ============================================
    match /systemAuditLogs/{logId} {
      allow read, write: if true;
    }

    // ============================================
    // USER TAGS COLLECTION
    // ============================================
    match /userTags/{tagId} {
      allow read, write: if true;
    }

    // ============================================
    // CONTENT MODERATION: REPORTS COLLECTION
    // ============================================
    match /contentReports/{reportId} {
      allow read, write: if true;
    }

    // ============================================
    // CONTENT MODERATION: USER STRIKES COLLECTION
    // ============================================
    match /userStrikes/{strikeId} {
      allow read, write: if true;
    }

    // ============================================
    // CONTENT MODERATION: USER RESTRICTIONS COLLECTION
    // ============================================
    match /userRestrictions/{restrictionId} {
      allow read, write: if true;
    }

    // ============================================
    // CONTENT MODERATION: ACTIVITY LOGS COLLECTION
    // ============================================
    match /moderationActivities/{activityId} {
      allow read, write: if true;
    }

    // ============================================
    // LEGAL REQUESTS COLLECTION
    // ============================================
    match /legalRequests/{requestId} {
      // For testing: allow all access
      // In production, implement proper role-based access:
      // - Company admins and HR can create and read their own company's requests
      // - Super admins can read, review, and update all requests
      allow read, write: if true;
    }

    // ============================================
    // SEARCH: SAVED SEARCHES COLLECTION
    // ============================================
    match /savedSearches/{searchId} {
      allow read, write: if true;
    }

    // ============================================
    // SEARCH: ANALYTICS COLLECTION
    // ============================================
    match /searchAnalytics/{analyticsId} {
      allow read, write: if true;
    }

    // ============================================
    // NOTIFICATION PREFERENCES COLLECTION
    // ============================================
    match /notificationPreferences/{userId} {
      allow read, write: if true;
    }

    // ============================================
    // EMAIL QUEUE COLLECTION
    // ============================================
    match /emailQueue/{emailId} {
      allow read, write: if true;
    }

    // ============================================
    // ALLOW ALL OTHER COLLECTIONS (for testing)
    // ============================================
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
