rules_version = '2';

// Firebase Storage Security Rules
// These rules allow unauthenticated access for testing purposes
service firebase.storage {
  match /b/{bucket}/o {

    // ============================================
    // IMPORTANT: FIREBASE AUTH IS DISABLED
    // ============================================
    // These rules allow unauthenticated access for testing purposes.
    // WARNING: This is NOT suitable for production use.
    // You should implement proper authentication and authorization
    // before deploying to production.
    // ============================================

    // ============================================
    // HELPER FUNCTIONS
    // ============================================

    // Validate file size (max 10MB for images, 50MB for documents)
    function isValidFileSize(maxSizeMB) {
      return request.resource.size <= maxSizeMB * 1024 * 1024;
    }

    // Validate image file types
    function isValidImageType() {
      return request.resource.contentType.matches('image/.*') &&
             request.resource.contentType in ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
    }

    // Validate document file types
    function isValidDocumentType() {
      return request.resource.contentType in [
        'application/pdf',
        'application/msword',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/vnd.ms-excel',
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        'text/plain',
        'text/csv'
      ];
    }

    // ============================================
    // USER PROFILE IMAGES
    // Path: companies/{companyId}/users/{userId}/profile/{fileName}
    // ============================================
    match /companies/{companyId}/users/{userId}/profile/{fileName} {
      // Allow read and write for testing (with file size validation)
      allow read: if true;
      allow write: if isValidImageType() && isValidFileSize(5); // 5MB max
      allow delete: if true;
    }

    // ============================================
    // COMPANY LOGOS
    // Path: companies/{companyId}/logo/{fileName}
    // ============================================
    match /companies/{companyId}/logo/{fileName} {
      // Allow read and write for testing (with file size validation)
      allow read: if true;
      allow write: if isValidImageType() && isValidFileSize(5); // 5MB max
      allow delete: if true;
    }

    // ============================================
    // POST ATTACHMENTS
    // Path: companies/{companyId}/posts/{postId}/attachments/{fileName}
    // ============================================
    match /companies/{companyId}/posts/{postId}/attachments/{fileName} {
      // Allow read and write for testing (with file size validation)
      allow read: if true;
      allow write: if (isValidImageType() || isValidDocumentType()) && isValidFileSize(50); // 50MB max
      allow delete: if true;
    }

    // ============================================
    // DISCUSSION ATTACHMENTS
    // Path: companies/{companyId}/discussions/{discussionId}/attachments/{fileName}
    // ============================================
    match /companies/{companyId}/discussions/{discussionId}/attachments/{fileName} {
      // Allow read and write for testing (with file size validation)
      allow read: if true;
      allow write: if (isValidImageType() || isValidDocumentType()) && isValidFileSize(50); // 50MB max
      allow delete: if true;
    }

    // ============================================
    // BILLING DOCUMENTS
    // Path: companies/{companyId}/billing/{documentType}/{fileName}
    // ============================================
    match /companies/{companyId}/billing/{documentType}/{fileName} {
      // Allow read and write for testing
      allow read: if true;
      allow write: if true;
      allow delete: if true;
    }

    // ============================================
    // COMPANY DOCUMENTS (General)
    // Path: companies/{companyId}/documents/{category}/{fileName}
    // ============================================
    match /companies/{companyId}/documents/{category}/{fileName} {
      // Allow read and write for testing (with file size validation)
      allow read: if true;
      allow write: if isValidDocumentType() && isValidFileSize(50); // 50MB max
      allow delete: if true;
    }

    // ============================================
    // TEMPORARY UPLOADS
    // Path: temp/{userId}/{fileName}
    // For temporary file storage during multi-step uploads
    // ============================================
    match /temp/{userId}/{fileName} {
      // Allow read and write for testing (with file size validation)
      allow read: if true;
      allow write: if (isValidImageType() || isValidDocumentType()) && isValidFileSize(50);
      allow delete: if true;
    }

    // ============================================
    // ADMIN UPLOADS
    // Path: admin/{category}/{fileName}
    // For system-wide resources
    // ============================================
    match /admin/{category}/{fileName} {
      // Allow read and write for testing (with file size validation)
      allow read: if true;
      allow write: if (isValidImageType() || isValidDocumentType()) && isValidFileSize(50);
      allow delete: if true;
    }

    // ============================================
    // ANALYTICS EXPORTS
    // Path: companies/{companyId}/exports/{exportType}/{fileName}
    // ============================================
    match /companies/{companyId}/exports/{exportType}/{fileName} {
      // Allow read and write for testing
      allow read: if true;
      allow write: if true;
      allow delete: if true;
    }

    // ============================================
    // ALLOW ALL OTHER PATHS (for testing)
    // ============================================
    match /{allPaths=**} {
      allow read, write: if true;
    }
  }
}
